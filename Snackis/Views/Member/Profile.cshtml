@model FullViewModel
@{
    ViewData["Title"] = "Profile";

}
<div class="profile-page">

    <!-- CHATTEN TILL VÄNSTER -->
    <div class="chat-container" style="flex: auto; flex-direction:row;">
        <div class="chat-users" style="color:black">
            <p><b>Users</b></p>

            <input type="button" value="Create chatt" onclick="document.getElementById('conversationBox').style.display = 'block'" style="margin-top: -1rem; margin-bottom:-1.5rem; background-color: cornflowerblue" />
            <div id="conversationBox" style="
                  display:none;
                  position:fixed;
                  top:20%;
                  left:40%;
                  transform:translate(-50%, -50%);
                  background:#fff;
                  padding:1rem;
                  border:1px solid #ccc;
                  border-radius:8px;
                  box-shadow:0 4px 12px rgba(0,0,0,0.2);
                  z-index:1000;
                  max-width:400px;
                  width:90%;
                ">
                <header class="conversation-box__header" aria-label="Skapa konversation" style="display:flex; flex-direction: row; justify-content:space-between;">
                    <h3 style="margin:0;font-size:1rem;">Create Conversation</h3>
                    <button type="button" class="conversation-box__close" aria-label="Stäng" style="background:red;" onclick="this.closest('#conversationBox').style.display='none'">✕</button>
                </header>

                <form asp-controller="Member" asp-action="CreateChatt">
                    <label for="conversationId" style="display:block;margin:0.5rem 0 0.25rem;font-size:.9rem;">Message to?</label>
                    <input id="conversationId"
                           name="userName"
                           type="text"
                           placeholder="Type Username here.."
                           required
                           style="width:100%;box-sizing:border-box;padding:.5rem;border:1px solid #ccc;border-radius:6px;" />
                    <span asp-validation-for="@Model.Member.UserName" class="text-danger"></span>

                    <label for="conversationText" style="display:block;margin:0.5rem 0 0.25rem;font-size:.9rem;">Text to Member</label>
                    <input type="text" asp-for="@Model.Chat.Text"
                           id="conversationText"
                           placeholder="Chatt message here.."
                           required
                           style="width:100%;box-sizing:border-box;padding:.5rem;border:1px solid #ccc;border-radius:6px;" />

                    <input type="hidden" asp-for="@Model.Chat.SenderId" value="@Model.Member.Id" />

                    <div style="display:flex;gap:.5rem;margin-top:.75rem;justify-content:flex-end;">
                        <button type="submit" class="conversation-box__create" style="padding:.5rem .75rem;border-radius:6px;border:1px solid #2b6cb0;background:#2b6cb0;color:#fff;">
                            Create
                        </button>
                    </div>
                </form>
            </div>


            <hr />
            <ul>
                @if (Model.Chatts != null)
                {
                    foreach (var chatt in Model.Chatts)
                    {
                        var otherUser = chatt.SenderId == Model.Member.Id
                        ? chatt.ReceiverMember
                        : chatt.SenderMember;

                        <li>
                            <a asp-controller="Member" asp-action="Profile" asp-route-receiverId="@otherUser.Id">
                                <input type="button" value="@otherUser.UserName" onclick="toggleChat()" style="background-color: aquamarine" />
                            </a>
                        </li>
                    }
                }
            </ul>
        </div>

        <div class="chat-area">
            @if (Model.ChattMessages != null)
            {
                <div class="chat-messages" id="chat-messages">
                    @foreach (var message in Model.ChattMessages)
                    {
                        @if (message.SenderId == Model.Member.Id)
                        {
                            <div class="message me" style="color:black">
                                <b>@Model.Member.UserName</b> @message.TimeCreated.ToString("yyyy/MM/dd - HH:mm") <br />
                                <hr style="margin-top: 0rem;" />

                                @message.Text
                            </div>
                        }
                        else
                        {
                            <div class="message other" style="color:black">
                                <b style="justify-self: flex-end">@message.SenderMember.UserName</b> @message.TimeCreated.ToString("yyyy/MM/dd - HH:mm") <br />
                                <hr style="margin-top: 0rem;" />
                                @message.Text
                            </div>
                        }
                    }
                </div>

                <div class="chat-input">
                    <form asp-controller="Member" asp-action="SendMessage">
                        <input type="hidden" asp-for="@Model.Chat.SenderId" value="@Model.Member.Id" />
                        <input type="hidden" asp-for="@Model.Chat.ReceiverId" value="@Model.ReceiverMemberID" />

                        <input type="text" placeholder="Type message here..." asp-for="@Model.Chat.Text" />
                        <button type="submit">Send</button>
                    </form>
                </div>
            }
        </div>
    </div>

    <!-- PROFILSIDA MITTEN -->
    <div style="display: flex; flex-direction:column; align-items:center; width: 50rem; margin-right:7.8rem;">
        <h1>@ViewData["Title"] Page</h1>
        <br />
        <img src="@Model.Member.ProfileImagePath" alt="Profile picture" style="width:150px;height:150px;object-fit:cover;" />
        <form asp-controller="Member" asp-action="Profile" method="post" enctype="multipart/form-data">

            <input asp-for="UploadedImage" style="margin-left: 9rem;" /><br />
            <input type="submit" class="btn btn-success" value="Change Picture" style="margin-left: 9rem; margin-top: 0.3rem;" />
        </form>
        <br />
        <br />

        <p><b>First name: </b>@Model.Member.FirstName</p>
        <p><b>Last name: </b>@Model.Member.LastName</p>
        <p><b>Age: </b>@Model.Member.Age</p>
        <p><b>Email: </b>@Model.Member.Email</p>
        <br />
        <p><b>Username: </b>@Model.Member.UserName</p>
        <p><b>Views on profile: </b>@Model.Member.MemberViews.Count()</p>
        <p><b>Member since: </b>@Model.Member.RegisteryDate</p>
        <br />
        <p><b>Total post from you: </b>@Model.Member.TotalPosts</p>
        <p><b>Total replies from you: </b>@Model.Member.TotalReply</p>
        <br />
        <p><b>Total reports: </b>@Model.Member.Reports</p>

        <br />
        <a asp-controller="Member" asp-action="Update" asp-route-Id="@Model.Member.Id">Update info</a>
    </div>

    <!-- Höger tom spalt -->
    <div style="display: flex; width: 30%;">
        <p>
            <b>Info</b>
            <br />
            @Model.Member.UserInfo
        </p>
    </div>
</div>

